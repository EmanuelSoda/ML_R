---
title: "Machine Learning Projet"
author: "Emanuel Michele Soda"
date: "6/6/2021"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(pheatmap)
library(stringr)
library("GGally")
library(factoextra)
library(plotly)
library("gridExtra")
source("code/plot_Scatterplot.R")
library(caret)
library(mlbench)
library("M3C")
```

# Read Data 

```{r read data}
train <- read_csv(file = "data/train.csv", col_types = cols(.default = col_double(),
  class = col_factor()))
row.names(train) <- paste("Sample", 1:dim(train)[1], sep = "_")
class_name <- train$class
```


# Dataset description 
```{r number of sample}
train %>%  group_by(class) %>% summarise(numberOfSample = n()) %>% 
  ggplot(data=., aes(x=class, y=numberOfSample, fill= class)) +
  geom_bar(stat="identity") +
  ggtitle("Number of sample for each class") + 
  geom_text(aes(label=numberOfSample), position = position_stack(vjust=0.5), size=10) +
  scale_fill_brewer(palette="Set3") +
  theme_minimal()

train %>% mutate(type = if_else(str_detect(class, regex(pattern = "t-")), 
                                true = "Trisomic", 
                                false = "Control")) %>% 
  group_by(type) %>% summarise(numberOfSample = n()) %>% 
  ggplot(data=., aes(x=type, y=numberOfSample, fill=type)) +
  geom_bar(stat="identity") +
  ggtitle("Number of sample for each Genotype") + 
  geom_text(aes(label=numberOfSample), position = position_stack(vjust=0.5), size=10) +
  scale_fill_manual(values=c("#999999", "#E69F00")) +
  theme_minimal()


ggcorr(train, hjust = 0.75, size = 2, color = "grey50")

```

# PCA plots

```{r PCA, echo=FALSE}
pca_train <- prcomp(train[,1:76], scale = TRUE)
fviz_eig(pca_train, barfill = "steelblue", 
         barcolor = "black") + ggtitle("Percentage of Exaplained variances")
pca_data <- data.frame(pca_train$x)
pca_data$class <- class_name

```

```{r Interactive Scatterplot PCA, echo=FALSE, fig.height=15, fig.width=15}
fig <- plot_ly(pca_data, x = ~PC1, y = ~PC2, z = ~PC3, color = ~class)
fig <- fig %>% add_markers()
fig
```

```{r  Scatterplot PCA, echo=FALSE}
plot_Scatterplot(pca_data)
```

# Fetature Selection
```{r fetature Selection, echo=FALSE}
# run the RFE algorithm
control <- rfeControl(functions=rfFuncs, method="cv", number=10)
results <- rfe(train[, 1:76], class_name, sizes=c(1:20), rfeControl=control)

# summarize the results
print(results)
```

```{r Plot fetature Selection, echo=FALSE}
# plot the results
plot(results, type=c("g", "o"))

# list the chosen features
predictors(results)


train %>%  select(predictors(results)) %>%  
  mutate(class = class_name) %>%  group_by(class)  %>% 
  ggplot(., aes(y=class, fill=class)) +
  geom_boxplot(outlier.colour="black", outlier.shape=16,
             outlier.size=2, notch=T) + 
  scale_fill_brewer(palette="Set3")
train %>%  select(predictors(results)[1:3]) %>%  
  mutate(class = class_name) %>% 

  ggpairs(., aes(colour = class, alpha = 0.4)) 
```

